{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\psing\\\\OneDrive\\\\Desktop\\\\ZenTalk\\\\client\\\\src\\\\Home\\\\Chat window\\\\Videocall.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport socket from \"../../socket\";\nimport Peer from \"simple-peer\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport \"./Videocall.css\";\nimport { faPhone, faPhoneSlash, faTimes } from \"@fortawesome/free-solid-svg-icons\";\n\nconst Videocall = props => {\n  _s();\n\n  const [me, setMe] = useState(\"\");\n  const [stream, setStream] = useState();\n  const [receivingCall, setReceivingCall] = useState(false);\n  const [caller, setCaller] = useState(\"\");\n  const [callerSignal, setCallerSignal] = useState();\n  const [callAccepted, setCallAccepted] = useState(false);\n  const [idToCall, setIdToCall] = useState(\"\");\n  const [callEnded, setCallEnded] = useState(false);\n  const [name, setName] = useState(props.myInfo.result.givenName + \" \" + props.myInfo.result.familyName + \"(\" + props.myInfo.result.email.split(\"@\")[0] + \")\");\n  const myVideo = useRef();\n  const userVideo = useRef();\n  const connectionRef = useRef();\n  useEffect(() => {\n    //Webcam streaming enabled here\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      setStream(stream);\n      myVideo.current.srcObject = stream;\n    });\n    setIdToCall(props.currentUser.userID);\n    setMe(socket.id);\n    socket.on(\"callUser\", data => {\n      setReceivingCall(true);\n      setCaller(data.from);\n      setName(data.name);\n      setCallerSignal(data.signal);\n    });\n  }, [props.showVideoCall]);\n\n  const callUser = id => {\n    console.log(\"Call user activated\");\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream: stream\n    });\n    peer.on(\"signal\", data => {\n      socket.emit(\"callUser\", {\n        userToCall: id,\n        signalData: data,\n        from: me,\n        name: name\n      });\n    });\n    peer.on(\"stream\", stream => {\n      userVideo.current.srcObject = stream;\n    });\n    socket.on(\"callAccepted\", signal => {\n      setCallAccepted(true);\n      peer.signal(signal);\n    });\n    connectionRef.current = peer;\n  };\n\n  const answerCall = () => {\n    setCallAccepted(true);\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream: stream\n    });\n    peer.on(\"signal\", data => {\n      socket.emit(\"answerCall\", {\n        signal: data,\n        to: caller\n      });\n    });\n    peer.on(\"stream\", stream => {\n      userVideo.current.srcObject = stream;\n    });\n    peer.signal(callerSignal);\n    connectionRef.current = peer;\n  };\n\n  const leaveCall = () => {\n    socket.emit(\"callEnded\", {\n      to: caller\n    });\n    setCallEnded(true);\n    connectionRef.current.destroy();\n\n    if (stream != null) {\n      stream.getTracks().map(function (val) {\n        val.stop();\n      });\n    }\n\n    props.showCallStatus(callEnded);\n    return;\n  };\n\n  socket.on(\"callEnded\", () => {\n    console.log(\"Call ended with user\");\n    setCallEnded(true);\n    connectionRef.current.destroy();\n\n    if (stream != null) {\n      stream.getTracks().map(function (val) {\n        val.stop();\n      });\n    }\n\n    props.showCallStatus(callEnded);\n  });\n\n  const closeVideoCallComponent = () => {\n    if (connectionRef.current) {\n      leaveCall();\n    } else {\n      if (stream != null) {\n        stream.getTracks().map(function (val) {\n          val.stop();\n        });\n      }\n\n      props.showCallStatus(callEnded);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"video-call-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cross-button-container\",\n      children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n        icon: faTimes,\n        className: \"cross-button\",\n        onClick: closeVideoCallComponent\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"my-video-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"user-video\",\n        children: callAccepted && !callEnded ? /*#__PURE__*/_jsxDEV(\"video\", {\n          playsInline: true,\n          ref: userVideo,\n          autoPlay: true,\n          style: {\n            width: \"500px\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"waiting-user-feed\",\n          children: \"Waiting for user feed\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"my-video\",\n        children: stream && /*#__PURE__*/_jsxDEV(\"video\", {\n          playsInline: true,\n          muted: true,\n          ref: myVideo,\n          autoPlay: true,\n          style: {\n            width: \"200px\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Button-container-1\",\n      children: callAccepted && !callEnded ? /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: leaveCall,\n        className: \"end-call-button\",\n        children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n          icon: faPhoneSlash,\n          className: \"end-call-icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: () => callUser(idToCall),\n        className: \"make-call-button\",\n        children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n          icon: faPhone,\n          className: \"make-call-icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"see-this\",\n      children: receivingCall && !callAccepted ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"caller\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: [name, \" is calling...\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: answerCall,\n          className: \"answer-call-button\",\n          children: [\" \", \"Answer Call\", \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 11\n      }, this) : null\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 142,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Videocall, \"fs9kDYmSIzqwNIG0j51pcDvN0uw=\");\n\n_c = Videocall;\nexport default Videocall;\n\nvar _c;\n\n$RefreshReg$(_c, \"Videocall\");","map":{"version":3,"sources":["C:/Users/psing/OneDrive/Desktop/ZenTalk/client/src/Home/Chat window/Videocall.js"],"names":["React","useState","useEffect","useRef","socket","Peer","FontAwesomeIcon","faPhone","faPhoneSlash","faTimes","Videocall","props","me","setMe","stream","setStream","receivingCall","setReceivingCall","caller","setCaller","callerSignal","setCallerSignal","callAccepted","setCallAccepted","idToCall","setIdToCall","callEnded","setCallEnded","name","setName","myInfo","result","givenName","familyName","email","split","myVideo","userVideo","connectionRef","navigator","mediaDevices","getUserMedia","video","audio","then","current","srcObject","currentUser","userID","id","on","data","from","signal","showVideoCall","callUser","console","log","peer","initiator","trickle","emit","userToCall","signalData","answerCall","to","leaveCall","destroy","getTracks","map","val","stop","showCallStatus","closeVideoCallComponent","width"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport socket from \"../../socket\";\r\nimport Peer from \"simple-peer\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport \"./Videocall.css\";\r\nimport {\r\n  faPhone,\r\n  faPhoneSlash,\r\n  faTimes,\r\n} from \"@fortawesome/free-solid-svg-icons\";\r\n\r\nconst Videocall = (props) => {\r\n  const [me, setMe] = useState(\"\");\r\n  const [stream, setStream] = useState();\r\n  const [receivingCall, setReceivingCall] = useState(false);\r\n  const [caller, setCaller] = useState(\"\");\r\n  const [callerSignal, setCallerSignal] = useState();\r\n  const [callAccepted, setCallAccepted] = useState(false);\r\n  const [idToCall, setIdToCall] = useState(\"\");\r\n  const [callEnded, setCallEnded] = useState(false);\r\n  const [name, setName] = useState(\r\n    props.myInfo.result.givenName +\r\n      \" \" +\r\n      props.myInfo.result.familyName +\r\n      \"(\" +\r\n      props.myInfo.result.email.split(\"@\")[0] +\r\n      \")\"\r\n  );\r\n\r\n  const myVideo = useRef();\r\n  const userVideo = useRef();\r\n  const connectionRef = useRef();\r\n\r\n  useEffect(() => {\r\n    //Webcam streaming enabled here\r\n    navigator.mediaDevices\r\n      .getUserMedia({ video: true, audio: true })\r\n      .then((stream) => {\r\n        setStream(stream);\r\n        myVideo.current.srcObject = stream;\r\n      });\r\n    setIdToCall(props.currentUser.userID);\r\n    setMe(socket.id);\r\n\r\n    socket.on(\"callUser\", (data) => {\r\n      setReceivingCall(true);\r\n      setCaller(data.from);\r\n      setName(data.name);\r\n      setCallerSignal(data.signal);\r\n    });\r\n  }, [props.showVideoCall]);\r\n\r\n  const callUser = (id) => {\r\n    console.log(\"Call user activated\");\r\n    const peer = new Peer({\r\n      initiator: true,\r\n      trickle: false,\r\n      stream: stream,\r\n    });\r\n\r\n    peer.on(\"signal\", (data) => {\r\n      socket.emit(\"callUser\", {\r\n        userToCall: id,\r\n        signalData: data,\r\n        from: me,\r\n        name: name,\r\n      });\r\n    });\r\n\r\n    peer.on(\"stream\", (stream) => {\r\n      userVideo.current.srcObject = stream;\r\n    });\r\n\r\n    socket.on(\"callAccepted\", (signal) => {\r\n      setCallAccepted(true);\r\n      peer.signal(signal);\r\n      \r\n    });\r\n\r\n    connectionRef.current = peer;\r\n  };\r\n\r\n  const answerCall = () => {\r\n    setCallAccepted(true);\r\n    const peer = new Peer({\r\n      initiator: false,\r\n      trickle: false,\r\n      stream: stream,\r\n    });\r\n\r\n    peer.on(\"signal\", (data) => {\r\n      socket.emit(\"answerCall\", { signal: data, to: caller });\r\n    });\r\n\r\n    peer.on(\"stream\", (stream) => {\r\n      userVideo.current.srcObject = stream;\r\n    });\r\n\r\n    peer.signal(callerSignal);\r\n    connectionRef.current = peer;\r\n  };\r\n\r\n  const leaveCall = () => {\r\n    socket.emit(\"callEnded\", { to: caller });\r\n    setCallEnded(true);\r\n    connectionRef.current.destroy();\r\n    if (stream != null) {\r\n      stream.getTracks().map(function (val) {\r\n        val.stop();\r\n      });\r\n    }\r\n    props.showCallStatus(callEnded);\r\n    return;\r\n  };\r\n\r\n  socket.on(\"callEnded\", () => {\r\n    console.log(\"Call ended with user\");\r\n    setCallEnded(true);\r\n    connectionRef.current.destroy();\r\n    if (stream != null) {\r\n      stream.getTracks().map(function (val) {\r\n        val.stop();\r\n      });\r\n    }\r\n    props.showCallStatus(callEnded);\r\n  });\r\n\r\n  const closeVideoCallComponent = () => {\r\n    if (connectionRef.current) {\r\n      leaveCall();\r\n    } else {\r\n      if (stream != null) {\r\n        stream.getTracks().map(function (val) {\r\n          val.stop();\r\n        });\r\n      }\r\n      props.showCallStatus(callEnded);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"video-call-container\">\r\n      <div className=\"cross-button-container\">\r\n        <FontAwesomeIcon\r\n          icon={faTimes}\r\n          className=\"cross-button\"\r\n          onClick={closeVideoCallComponent}\r\n        ></FontAwesomeIcon>\r\n      </div>\r\n      <div className=\"my-video-container\">\r\n        <div className=\"user-video\">\r\n          {callAccepted && !callEnded ? (\r\n            <video\r\n              playsInline\r\n              ref={userVideo}\r\n              autoPlay\r\n              style={{ width: \"500px\" }}\r\n            />\r\n          ) : (\r\n            <div className=\"waiting-user-feed\">Waiting for user feed</div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"my-video\">\r\n          {stream && (\r\n            <video\r\n              playsInline\r\n              muted\r\n              ref={myVideo}\r\n              autoPlay\r\n              style={{ width: \"200px\" }}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"Button-container-1\">\r\n        {callAccepted && !callEnded ? (\r\n          <div onClick={leaveCall} className=\"end-call-button\">\r\n            <FontAwesomeIcon\r\n              icon={faPhoneSlash}\r\n              className=\"end-call-icon\"\r\n            ></FontAwesomeIcon>\r\n          </div>\r\n        ) : (\r\n          <div onClick={() => callUser(idToCall)} className=\"make-call-button\">\r\n            <FontAwesomeIcon\r\n              icon={faPhone}\r\n              className=\"make-call-icon\"\r\n            ></FontAwesomeIcon>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"see-this\">\r\n        {receivingCall && !callAccepted ? (\r\n          <div className=\"caller\">\r\n            <h1>{name} is calling...</h1>\r\n            <button onClick={answerCall} className=\"answer-call-button\">\r\n              {\" \"}\r\n              Answer Call{\" \"}\r\n            </button>\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Videocall;\r\n"]},"metadata":{},"sourceType":"module"}